<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- ============================================================== -->
<!-- ================可直接使用Base配置文件中定义的节点！================ -->
<!-- ============================================================== -->
<mapper namespace="com.lawfirm.lawfirmserver.user.dao.UsersDao">
    <!-- 请在下方添加自定义配置-->

    <!-- 按用户名查询一条记录 -->
    <select id="selectUserByUserName" resultMap="BaseResultMap" parameterType="map">
        select
        <include refid="Base_Column_List"/>
        from users
        where username = #{username}
    </select>

    <!-- 按用户电话号码查询一条记录 -->
    <select id="selectByPhone" resultMap="BaseResultMap" parameterType="map">
        select
        <include refid="Base_Column_List"/>
        from users
        where phoneNumber = #{phone}
    </select>

    <!-- 按用户id查询一条记录 -->
    <select id="selectById" resultMap="BaseResultMap" parameterType="map">
        select
        <include refid="Base_Column_List"/>
        from users
        where id = #{userId}
    </select>

    <!-- 根据关联实体ID和用户类型查询用户 -->
    <select id="selectByRelatedEntityId" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from users
        where relatedEntityId = #{relatedEntityId}
        <if test="userType != null and userType != ''">
            and userType = #{userType}
        </if>
        and isValidFlag = '1'
        limit 1
    </select>

    <!-- 插入一条记录(为空的字段不操作) -->
    <insert id="insertSelectiveAndBackId" parameterType="com.lawfirm.lawfirmserver.user.po.Users">
        <selectKey keyProperty="id" resultType="Long" order="AFTER">
            SELECT LAST_INSERT_ID() AS value
        </selectKey>
        insert into users
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="openId != null">
                openId,
            </if>
            <if test="username != null">
                username,
            </if>
            <if test="password != null">
                password,
            </if>
            <if test="passwordUpdateTime != null">
                passwordUpdateTime,
            </if>
            <if test="nickName != null">
                nickName,
            </if>
            <if test="email != null">
                email,
            </if>
            <if test="phoneNumber != null">
                phoneNumber,
            </if>
            <if test="userType != null">
                userType,
            </if>
            <if test="sourceType != null">
                sourceType,
            </if>
            <if test="relatedEntityId != null">
                relatedEntityId,
            </if>
            <if test="createTime != null">
                createTime,
            </if>
            <if test="isValidFlag != null">
                isValidFlag,
            </if>
            operateTimeForHis,
        </trim>
        values
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id},
            </if>
            <if test="openId != null">
                #{openId},
            </if>
            <if test="username != null">
                #{username},
            </if>
            <if test="password != null">
                #{password},
            </if>
            <if test="passwordUpdateTime != null">
                #{passwordUpdateTime},
            </if>
            <if test="nickName != null">
                #{nickName},
            </if>
            <if test="email != null">
                #{email},
            </if>
            <if test="phoneNumber != null">
                #{phoneNumber},
            </if>
            <if test="userType != null">
                #{userType},
            </if>
            <if test="sourceType != null">
                #{sourceType},
            </if>
            <if test="relatedEntityId != null">
                #{relatedEntityId},
            </if>
            <if test="createTime != null">
                #{createTime},
            </if>
            <if test="isValidFlag != null">
                #{isValidFlag},
            </if>
            now(),
        </trim>
    </insert>

</mapper>